function map(i,t,s,h,e){return h+(e-h)*(i-t)/(s-t)}function addCommas(i){return String(i).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}function min(i){for(var t,s=0;s<i.length;s++)(!t||t>i[s])&&(t=i[s]);return t}function max(i){for(var t,s=0;s<i.length;s++)(!t||t<i[s])&&(t=i[s]);return t}function setup(){createCanvas(canvasW,canvasH).parent("canvas"),frameRate(0),$.getJSON("json/data.json",function(i,t){data=i,objYearText=new yearText(canvasW-10,0),objSlider=new slider(0,.65*canvasH,canvasW,.35*canvasH);for(var s=0;s<COINS.length;s++)objCoins[s]=new coin(s,s*(canvasW/6),0,canvasW/6,.6*canvasH),objLines[s]=new kLine(s,objSlider.x,objSlider.y,objSlider.w,objSlider.h);frameRate(20)})}function draw(){clear();for(var i=0;i<COINS.length;i++)objCoins[i].display(),objLines[i].display();objYearText.display(),objSlider.display(),isClicking=!1,isPlaying&&(objSlider.value==objSlider.maxValue?stopButton():objSlider.value+=1)}function yearText(i,t){this.x=i,this.y=t,this.display=function(){noStroke(),fill(255,150),textAlign(RIGHT,TOP),fill(255,100),textSize(12),text("Unit: 1,000 pcs",this.x,this.y),fill(255,150),textSize(32),text(objSlider.value,this.x,this.y+16)}}function slider(i,t,s,h){this.x=i,this.y=t,this.w=s,this.h=h,this.minX=this.x+5,this.maxX=this.x+this.w-5,this.minValue=MIN_YEAR,this.maxValue=MAX_YEAR,this.value=this.minValue,this.rx=this.minX,this.ry=this.y+12,this.rw=4,this.rh=this.h-24,this.year=MIN_YEAR,this.hover=!1,this.display=function(){this.hover=!1;for(var i=0;i<=120;i++)this.mx=map(i,0,120,this.minX,this.maxX),this.ml=5,i%10==0&&(this.ml=9),i%20==0&&(this.ml=13),strokeWeight(1),stroke(color(COLORS.paleBlue)),line(this.mx,this.y,this.mx,this.y+this.ml),line(this.mx,this.y+this.h,this.mx,this.y+this.h-this.ml);this.x<=mouseX&&mouseX<=this.x+this.w&&this.y<=mouseY&&mouseY<=this.y+this.h&&(this.hover=!0),this.hover&&mouseIsPressed&&(this.tmpx=max(min(mouseX,this.maxX),this.minX),this.value=parseInt(map(this.tmpx,this.minX,this.maxX,this.minValue,this.maxValue))),this.rx=map(this.value,this.minValue,this.maxValue,this.minX,this.maxX),noStroke(),fill(COLORS.white),rect(this.rx-this.rw/2,this.ry,this.rw,this.rh,2)}}function coin(i,t,s,h,e){this.i=i,this.x=t,this.y=s,this.w=h,this.h=e,this.label=COINS[this.i],this.textX=4,this.textH=20,this.blank=.1*this.w,this.barX=this.x+this.blank,this.barW=this.w-2*this.blank,this.barY=this.y+this.h-40,this.display=function(){if(noStroke(),fill(130,230,250,30),rect(this.x+this.textX,this.y+this.h-this.textH/2,this.w-2*this.textX,this.textH,this.textH/2),textAlign(CENTER,CENTER),textSize(15),noStroke(),fill(COLORS.paleBlue),text("Â¥"+this.label,this.x+this.w/2,this.y+this.h),this.barV=data.years[objSlider.value][this.label],this.barH=map(this.barV,MIN_VALUE,MAX_VALUE,0,this.h),this.barV){this.blockH=3,this.blockN=parseInt(this.barH/this.blockH)+1,stroke(color(COLORS.background)),strokeWeight(1);for(var i=0;i<this.blockN;i++)fill(COLORS.coins[this.i]),rect(this.barX,this.barY-i*this.blockH,this.barW,this.blockH,this.blockH/2);textAlign(CENTER,BOTTOM),textSize(11),text(addCommas(this.barV),this.x+this.w/2,this.y+this.h-20)}}}function kLine(i,t,s,h,e){this.i=i,this.x=t+5,this.y=s+18,this.w=h-10,this.h=e-36,this.color=COLORS.coins[this.i],this.min=data.coins[this.i].min,this.values=data.coins[this.i].values,this.sw=this.w/(MAX_YEAR-MIN_YEAR),this.sx=(this.min-MIN_YEAR)*this.sw+this.x,this.display=function(){stroke(this.color),strokeWeight(2),noFill(),beginShape();for(var i=0;i<this.values.length;i++){var t=this.sx+this.sw*i,s=map(this.values[i],MIN_VALUE,MAX_VALUE,this.y+this.h,this.y);vertex(t,s)}endShape()}}function mousePressed(){isClicking=!0}var data,objYearText,objButton,objSlider,canvasW=$("#canvas").width(),canvasH=$("#canvas").height(),COINS=["1","5","10","50","100","500"],MIN_YEAR=1948,MAX_YEAR=2016,MIN_VALUE=0,MAX_VALUE=3e6,COLORS={background:"#102040",blue:"#369",paleBlue:"rgba(160,240,250,200)",yellow:"#ec4",white:"#fefefe",coins:["rgba(239,160,153,1)","rgba(244,202,129,1)","rgba(202,234,58,1)","rgba(36,215,124,1)","rgba(158,171,255,1)","rgba(209,128,229,1)"]},isClicking=!1,isPlaying=!1,objCoins=new Array(6),objLines=new Array(6);