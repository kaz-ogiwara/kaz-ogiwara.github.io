<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=9" />
		<title>Earthquakes</title>
		<link rel="stylesheet" href="//stanko.github.io/skyblue/css/skyblue.min.css" />
		<style>
			*{
				margin:0 auto;
				padding:0;
				color: rgba(255,255,255,0.9);
				font-family: Helvetica, sans-serif;
			}
			
			html,body{
				background-color:rgb(10,20,30);
			}
			
			.row{
				padding-top: 20px;
			}
			
			.xs-12 div{
				color: rgba(255,255,255,0.7);
			}
			
			#loading{
				width: 100%;
				height: 360px;
				padding-top: 100px;
				text-align: center;
				z-index: 100000;
			}	

			canvas{
				display:block;
				margin:auto;
			}

			#tooltip {
				position: fixed;
				box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.75);
				display: none;
				padding: 15px;
				background-color: #f0f0f0;
				border-radius: 5px;
				z-index: 60;
				min-width: 200px;
				max-width: 400px;
			}
			
			#tooltip *{
				color: #102030;
				font-size: 10pt;
				line-height: 15px;
			}
			
			.title{
				font-weight: bold;
				margin-bottom: 5px;
			}

			#tooltip:before{
				content:"";
				display:block;
				position:absolute;
				height:0;
				width:0;
				border: 10px transparent solid;
				border-right-width:0;
				border-left-color:#f0f0f0;
				z-index: 50;
				left: calc(50% - 6px);
				top: -13px;
				transform:rotate(270deg);
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="row">
				<div class="col xs-12">
					<h2>Earthquakes in the world</h2>
					<h4>Animation of earthquakes on the earth in the past an hour to 30 days</h4>
					<br>
					<div>- Select period and magnitudes from select boxes</div>
					<div>- Move circle on the bar below the map and play / stop animation with a button on bottom left</div>
					<div>- Play / stop animation with a button on bottom left</div>
					<div>- Select data again to refresh data as the latest</div>
					<div>- By hovering each quake, detail information will be shown</div>
					<div>- Data from: <a href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/" target="_blank">U.S. Geological Survey</a></div>
					<br>
				</div>
				<div class="col xs-6">
					<select class="form-control" id="select-time">
						<option value="hour">Past Hour</option>
						<option value="day">Past Day</option>
						<option value="week" selected="selected">Past 7 Days</option>
						<option value="month">Past 30 Days</option>
					</select>
				</div>
				<div class="col xs-6">
					<select class="form-control" id="select-mag">
						<option value="significant">Significant Earthquakes</option>
						<option value="4.5">M4.5+ Earthquakes</option>
						<option value="2.5">M2.5+ Earthquakes</option>
						<option value="1.0">M1.0+ Earthquakes</option>
						<option value="all" selected="selected">All Earthquakes</option>
					</select>
				</div>
			</div>
		</div>
		<div id="tooltip">
			<div id="tooltip-inner"></div>
		</div>
		<div id="loading">
			<img src="loading.gif" alt="" />
			<div>Loading...</div>
		</div>
		<br>
		<script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
		<script>
			var json;
			
			function loadJson() {
				$("canvas").remove();
				$("#loading").show();
				
				var time = $("#select-time").val();
				var mag  = $("#select-mag").val();

				var url = "http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/" + mag + "_" + time + ".geojson";

				$.getJSON(url).done(function(data){
					json = data;
					
					$("#loading").hide();

					// p5 and sketch are loaded after json was stored in a variable
					$.getScript("//cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.6/p5.min.js");
					$.getScript("sketch.js");
				});
      }
			
			$(function(){
				$("select").on("change",function(){
					loadJson();
				});

				loadJson();
			});
		</script>
	</body>
</html>
